var Game;(function(n){var t=function(){function n(){}return n.prototype.getWorldX=function(){return this.ZoneData.worldX},n.prototype.getWorldY=function(){return this.ZoneData.worldY},n.prototype.getWidth=function(){return 512},n.prototype.getHeight=function(){return 512},n}(),i;n.MapZoneLayer=t,i=function(){function n(n){this.gameBoardID=n,this.entities=[],this.mapZoneLayers=[]}return n.prototype.init=function(){var t=$("#"+this.gameBoardID),n=t.parent().width(),i=n;this.stage=new Kinetic.Stage({container:this.gameBoardID,width:n,height:i}),this.worldGroup=new Kinetic.Group,this.worldGroup.setDraggable(!0),this.worldLayer=new Kinetic.Layer,this.worldLayer.add(this.worldGroup),this.stage.add(this.worldLayer)},n.prototype.renderMapZone=function(n){var i=new t;i.KineticGroup=new Kinetic.Group,i.ZoneData=n;var r=n.worldX,u=n.worldY,f=new Kinetic.Rect({x:r,y:u,width:i.getWidth(),height:i.getHeight(),name:"background",fill:"green"});i.KineticGroup.add(f),this.worldGroup.add(i.KineticGroup),this.worldLayer.draw(),this.mapZoneLayers.push(i)},n.prototype.getLayerUnderPoint=function(n){for(var f=this.mapZoneLayers.length,i=0;i<f;i++){var t=this.mapZoneLayers[i],r=t.getWorldX(),u=t.getWorldY(),e=r+t.getWidth(),o=u+t.getHeight();if(r<=n&&n<=e&&u<=n&&n<=o)return t}throw new Error("Unable to find a zone under point. There must have been a data loading error in the GameBoard.");},n.prototype.addEntity=function(n){var t,i;this.entities.push(n),n.setParentLayer(this.worldLayer),t=n.getKineticGroup(),n.canMove()?this.worldGroup.add(t):(i=this.getLayerUnderPoint(n._worldX,n._worldY).KineticGroup,i.add(n.getKineticGroup()))},n}(),n.GameBoard=i})(Game||(Game={})),QUnit.module("GameBoard"),QUnit.test("getLayerUnderPoint",function(){var n=new Game.GameBoard("testGameBoard"),i,t,r;n.init(),i={worldX:0,worldY:0},t={worldX:512,worldY:512},n.renderMapZone(i),n.renderMapZone(t),r=n.getLayerUnderPoint(600,256),QUnit.ok(r.ZoneData==t,"checking zone is valid")})